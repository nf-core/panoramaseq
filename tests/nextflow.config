/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Nextflow config file for nf-test
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Configuration file for running nf-test in CI/CD environments
----------------------------------------------------------------------------------------
*/

// Global test parameters
params {
    // Test data base paths - modules use modules branch, pipelines use commit
    modules_testdata_base_path = "https://raw.githubusercontent.com/nf-core/test-datasets/modules/data/"
    pipelines_testdata_base_path = "https://raw.githubusercontent.com/nf-core/test-datasets/7f1614baeb0ddf66e60be78c3d9fa55440465ac8/"
    
    // Panoramaseq specific test data
    panoramaseq_testdata_base_path = "https://raw.githubusercontent.com/francops1722/test-datasets/panoramaseq/testdata/"
    
    // Specific test datasets
    test_data_s3_path = "s3://nf-core-awsmegatests/panoramaseq/test-datasets/"
    
    // Force anonymous S3 access for test data
    igenomes_ignore = true
}

// Global resource limits for nf-test
process {
    resourceLimits = [
        cpus: 2,
        memory: '3.GB', 
        time: '2.h'
    ]
    
    // Error strategy for tests
    errorStrategy = { task.exitStatus in [143,137,104,134,139] ? 'retry' : 'finish' }
    maxRetries = 1
    maxErrors = '-1'
}

// Enable anonymous S3 access
aws {
    client {
        anonymous = true
    }
}

// Container configuration for tests
singularity {
    enabled = true
    autoMounts = true
}

// Disable other container engines  
docker.enabled = false
conda.enabled = false
podman.enabled = false
shifter.enabled = false
charliecloud.enabled = false
apptainer.enabled = false

// Nextflow options for testing
nextflow {
    // Clean up work directory after successful completion
    cleanup = true
    
    // Enable configuration debugging
    enable.dsl = 2
    
    // Disable automatic publishDir
    enable.moduleBinaries = false
}

// Profiles for different test scenarios
profiles {
    test_local {
        params.modules_testdata_base_path = "file://test-datasets/"
        params.pipelines_testdata_base_path = "file://test-datasets/panoramaseq/"
    }
    
    test_s3 {
        params.modules_testdata_base_path = "${params.test_data_s3_path}"
        params.pipelines_testdata_base_path = "${params.test_data_s3_path}panoramaseq/"
    }
}

// Manifest for test environment
manifest {
    defaultBranch = 'master'
    homePage = 'https://github.com/nf-core/panoramaseq'
    description = 'Test configuration for nf-core/panoramaseq'
}
